<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script type="text/javascript" src="/smoothie.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <title>Document</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div class="flex flex-col justify-center items-center">
      <div class="border-solid border-8 rounded-md border-slate-400 m-4">
        <div id="box" class="resize overflow-auto">
          <canvas id="mycanvas" width="1366" height="768"></canvas>
        </div>
      </div>
      <div class="flex flex-row justify-around w-full">
        <div>
          <button
            class="bg-slate-500 hover:bg-slate-700 text-white font-bold py-2 px-4 rounded"
            onclick="action1()"
          >
            action 1
          </button>
          <button
            class="bg-slate-500 hover:bg-slate-700 text-white font-bold py-2 px-4 rounded"
            onclick="action2()"
          >
            action 2
          </button>
        </div>
        <div>
          <p id="temperature" class="inline-block"></p>
          <button
            id="temptoggle"
            class="inline-block bg-slate-500 hover:bg-slate-700 text-white font-bold py-2 px-4 rounded"
            onclick="toggleCandF()"
          >
            *C
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
<script>
  const socket = io();

  var smoothie = new SmoothieChart();

  // Data
  var celciusgraph = new TimeSeries();
  var fahrenheitgraph = new TimeSeries();

  // Add a random value to each line every second
  // setInterval(function () {
  //   celciusgraph.append(Date.now(), Math.random());
  //   line2.append(Date.now(), Math.random());
  // }, 1000);

  socket.on("graph new data", function (data) {
    // console.log(
    //   "graph new data event occured time: " +
    //     data.time +
    //     " value: " +
    //     data.value
    // );
    if (celciusgraph.disabled) {
      document.getElementById("temperature").innerHTML =
        "Temp: " + ((data.value * 9) / 5 + 32);
    } else {
      document.getElementById("temperature").innerHTML = "Temp: " + data.value;
    }
    celciusgraph.append(data.time, data.value);
    fahrenheitgraph.append(data.time, (data.value * 9) / 5 + 32);
  });

  var smoothie = new SmoothieChart({
    maxValueScale: 0.88,
    minValueScale: 0.8,
    grid: {
      fillStyle: "#ffffff",
      strokeStyle: "#f7f7f7",
      verticalSections: 20,
    },
    labels: {
      fillStyle: "#000000",
      precision: 3,
      showIntermediateLabels: true,
    },
    tooltipLine: { strokeStyle: "#bbbbbb" },
    maxValue: 100,
    minValue: 0,
  });
  smoothie.addTimeSeries(celciusgraph, {
    lineWidth: 2,
    strokeStyle: "#5395c0",
    fillStyle: "rgba(83,149,192,0.20)",
    interpolation: "bezier",
  });
  smoothie.addTimeSeries(fahrenheitgraph, {
    lineWidth: 2,
    strokeStyle: "#5395c0",
    fillStyle: "rgba(83,149,192,0.20)",
    interpolation: "bezier",
  });
  fahrenheitgraph.disabled = true;

  smoothie.streamTo(document.getElementById("mycanvas"), 1000 /*delay*/);

  elem = document.getElementById("box");

  let resizeObserver = new ResizeObserver((target) => {
    let canvas = document.getElementById("mycanvas");
    let box = document.getElementById("box");
    canvas.style.width = box.style.width;
    canvas.style.height = box.style.height;
  });

  resizeObserver.observe(elem);

  function action1() {
    console.log("action1");
    socket.emit("action1");
  }
  function action2() {
    socket.emit("action2");
  }

  function toggleCandF() {
    if (celciusgraph.disabled == false) {
      celciusgraph.disabled = true;
      fahrenheitgraph.disabled = false;
      document.getElementById("temptoggle").innerHTML = "*F";
    } else {
      celciusgraph.disabled = false;
      fahrenheitgraph.disabled = true;
      document.getElementById("temptoggle").innerHTML = "*C";
    }
  }
</script>
